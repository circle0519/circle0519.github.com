---
layout: post
title: 'archlinux 2012.07.15安装'
date: '2012-08-05 15:01:00'
categories: ['Linux']
---

前天把以前的系统更新了一下,发现出现致命的问题,不能启动.奈何光驱又正在这时候读不出光盘的镜像文件.坑爹的事情总是发生在最悲剧的时候.选择安装archlinux最新的系统.并且选择硬盘的形式安装(我电脑一直都是XP+Archlinux).
<!--more-->
1.首先下载光盘镜像.这个很简单,国内的到<a href="http://mirrors.163.com/">网易镜像</a>下载就是了,速度还不错.

2.下载grub4dos,解压到C盘.修改C盘根目录下的boot.ini,添加一行
<pre><code>c:grldr="Grub4Dos"</code></pre>
在menu.list中添加内容
<pre><code>C:menu.lst
title  Install Arch Linux
root   (hd0,0)
kernel /vmlinuz archisolabel=archiso ##vmlinuz 从镜像的/boot中提取,放在C盘根目录
initrd /archiso.img    ##archiso.img 从镜像的/boot中提取出来的,放在C盘根目录</code></pre>
在启动过程中会查找/dev/disk/by-label/archiso文件，在我的电脑上是找不到的.按照<a href="http://blog.fooleap.org/hard-disk-installation-for-archlinux.html">博客</a>和<a href="https://wiki.archlinux.org/index.php/Hard_Disk_Installation_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">wiki</a>的内容
<pre><code># mkdir /win
# mkdir -p /dev/disk/by-label
# mount -r -t ntfs /dev/sda1 /win
# modprobe loop
# losetup /dev/loop6 /win/archlinux-2011.08.19-core-i686.iso
# ln -s /dev/loop6 /dev/disk/by-label/archiso
# exit</code></pre>
在命令行下就可以进入到引导启动的画面.最后参考的内容主要来自与<a href="https://wiki.archlinux.org/index.php/Beginners%27_Guide_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">Archlinux Wiki</a>.现在安装都是联网安装,安装的过程中需要联网下载软件包,因此,要将电脑连接到互联网上.有线dhcp很简单,可是我这里恰好只能用静态IP地址.因此,要设置静态的IP.

将硬盘分区分好,并且执行
<pre><span style="font-family: Menlo, Monaco, 'Courier New', monospace;color: #333333">mkfs.ext4 /dev/sdaX
mkfs.ext4 /dev/sdaY     ##格式化分区,创建文件系统</span></pre>
<pre># mkswap /dev/sdaX &amp;&amp; swapon /dev/sdaX  ##分区格式化为swap,并且创造swap分区</pre>
<div>
<pre><span style="font-family: Menlo, Monaco, 'Courier New', monospace;color: #333333"># mount /dev/sdaX /mnt   ##挂载/分区到/mnt上</span></pre>
</div>
<div>
<pre># mkdir /mnt/home &amp;&amp; mount /dev/sdaY  /mnt/home ##创建home文件,并且将Y分区挂载到上面</pre>
</div>
下面是设置系统的网络连接:

在命令行下输入:
<pre><span style="font-family: Menlo, Monaco, 'Courier New', monospace;color: #333333"># ip addr add &lt;ip address&gt;/&lt;subnetmask&gt; dev &lt;interface&gt;
# ip addr add 192.168.4.53/0 dev eth0</span></pre>
然后在/etc/resolve.conf文件中添加DSN服务器的IP地址:
<pre>nameserver  *.*.*.*
nameserver  *.*.*.*</pre>
然后在/etc/rc.conf 中添加一行 interface=eth0

重启网络连接:
<pre>/etc/rc.d/network restart</pre>
然后添加路由网关:
<pre><span style="font-family: 'Times New Roman'">ip route add default via 192.168.4.254</span></pre>
最后ping 一下就可以了.

下面的是系统安装的步骤了.
<pre><span style="font-family: 'Times New Roman'"># pacstrap /mnt base base-devel</span></pre>
安装系统引导程序:
<pre><span style="font-family: 'Times New Roman'"># pacstrap /mnt grub-bios</span></pre>
<div>安装成功之后,然后安装.然后生成/etc/fstab文件:</div>
<pre><span style="font-family: 'Times New Roman'"># genfstab -p /mnt &gt;&gt; /mnt/etc/fstab</span></pre>
然后输入 # arch-chroot /mnt 到安装的系统中去.

最后用: # mkinitcpio -p linux  ###创建一个初始 RAM disk：

安装中遇到的问题:

1.网络连接问题.如果在输入ip addr add ......这条命令后马上输入ip route add.....这条命令会返回错误信息.而且在配置网络的过程中提示我在/etc/rc.conf中没有interface的指定,因此要修改该文件,并且要network重启才能连接到网络上.

2. 我在进入系统安装程序之前,做好是将硬盘分区分后,然后用gurb4dos进入系统安装,否则,我的电脑上会出现cfdisk /dev/sda 后,就算分好,但是在mkfs.ext4的时候还是找不到分好的分区.这也是我遇到的问题.以前用archlinux安装是没有遇到这种问题的,现在我安装的时候遇到了,不解啊.......

3.开始我用以前的分区方式,将/usr分区单独放到一个硬盘分区里面,但是在安装程序都进行完之后,重启还是出现故障.我在论坛里面看到别人提供的解决方法,就是需要在/etc/mkinitcpio.conf文件里hook 中添加usr,只是后来我没有再为/usr单独分区.因此,这个方法我自己也没有机会验证了.

4.其他的一些小问题也遇到了,一时还想不起来这些小问题.不过都解决了,还好.现在用LXED桌面环境,感觉还不错啊.个人感觉用着比xfce4体验要稍好.
